# 日志系统功能预想

**日志用来记录用户操作、系统运行状态等，是一个系统的重要组成部分**

- 快速定位线上问题，包括测试环境，对系统运行情况更加清晰
- 更好掌握一些动态信息，对一些重要信息追踪

## 后台操作日志

### 后端请求部分

分为三部分：

> 通用部分

- 操作人员，需要每条请求带token了
- 发生时间，
- 请求路由

> http request信息(行为收集)

- UA，request，请求信息，

> 错误信息

- 错误 api，错误名字，错误信息，

> 几个约定的功能

1. 日志输出格式要求：JSON **时间**为必要属性
2. 日志等级，NONE>DEBUG>INFO>WARN>ERROR 参考[egg-logger](https://eggjs.org/zh-cn/core/logger.html)
3. 设置日志能够输出等级，等级参考如上，
4. 设置终端日志能够打印等级，

**按级别分**

## 系统级别

> 置于洋葱模型最外层，对系统层面上的输入输出

### 启动日志

- 用户信息
  - ip 地址
  - 使用客户端

## 函数级别

> 利用装饰器嵌入代码

**有个想法，我不想嵌入代码开发，可能只是在开发完成之后想去知道某个重要函数的情况。能不能把所有装饰器抽象出来**

- 函数信息
  - 函数名称
  - 函数入口参数
  - 函数输出参数

## 抉择

> 读写文件还是读写数据库？

1. 优先考虑读写文件，更快。符合大部分日志场景需求
2. 写入策略：同步写入内存，异步（间隔时间）写入文件 参考 [egg-日志性能](https://eggjs.org/zh-cn/core/logger.html#%E6%80%A7%E8%83%BD)
