# 作用域和闭包

编译

- 分词/词法分析
  - 生成词法单元流，序列化，
- 解析/语法分析
  - 生成 AST 抽象语法树
- 代码生成
  - AST 转换为可执行代码

引擎、编译、作用域

作用域
收集变量，实施规则

var a = 2

常规：
计算机先分配一个内存，命名为 a，然后，将值 2 存入内存中
实际上：
编译：
在相同作用域中询问是否有相同的变量，如果有了，继续编译，没有的话，就要求作用域申明一个新的变量 a
引擎：
先询问作用域，是否有 a 这样的变量，如果是，就是用，没有的话，继续查找

LHS 和 RHS 引用操作
赋值操作的目标是谁，谁是赋值操作的来源

```js
function foo(a) {
  var b = a
  return a + b
}
var c = foo(2)
```

上述代码，3 处 LHS 引用
分别是：

- var c
- a=2 隐式变量分配
- var b

4 处 RHS 引用

- foo(
- ... a
- a + ...
- ... +b

作用域 就是一个栈

作用域链

词法作用域
自己的作用域找不到就依次往上找，直到全局作用域

非严格模式下
RHS 一直找不到，就会有 RefereneceError
而 LHS 就会在全局作用域上中创建一个 undefined 变量

RHS 查询 进行不合理操作，比如 string 类型，进行函数调用，就会报 TypeError

词法作用域，词法阶段的租用域

词法作用域，管理规定引擎，在当前作用域，或嵌套作用域中，在针对变量标识符，如何查询变量

eval ，with
在运行的时候，修改了作用域，创建作用域
欺骗词法 运行时修改词法作用域
